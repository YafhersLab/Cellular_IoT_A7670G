//======================= LIBRERIAS ==========================// #include <DHT.h> #include <Wire.h> #include <RTClib.h> //===================== DEFINICIONES =========================// // Definiciones DHT #define DHT_PIN 25 #define DHT_TYPE DHT11 // Definiciones Sensor Capacitivo #define HUM_PIN 33 // Definiciones Led RGB #define RGB_RED 19 #define RGB_GREEN 18 #define RGB_BLUE 5 // Definiciones RTC DS3231 #define I2C_SCL 22 #define I2C_SDA 21 // Lectura de bateria 18650 #define PIN_BATTERY 35 //====================== VARIABLES ==========================// // Variables DHT float DHT_humidity = 0.0; float DHT_temperature = 0.0; // Variables sensor capacitivo float CAP_humidity = 0.0; // Variables lectura bater√≠a float BAT_level = 0.0; // Variables lectura RTC DS3231 DateTime rtc_info; //======================= OBJETOS ===========================// DHT dht(DHT_PIN, DHT_TYPE); RTC_DS3231 rtc; //====================== PROTOTIPOS =========================// // Prototipos de Tasks void readSensors(void* pvParameters); //====================== MAIN CODE ==========================// // Void Setup void setup() { // Inicializaci√≥n serial Serial.begin(115200); while(!Serial); // Inicializaci√≥n de pines RGB pinMode(RGB_RED, OUTPUT); pinMode(RGB_GREEN, OUTPUT); pinMode(RGB_BLUE, OUTPUT); // Inicializaci√≥n DHT dht.begin(DHT_PIN); // Inicializaci√≥n sensor capacitivo pinMode(HUM_PIN, INPUT); analogReadResolution(10); // Inicializaci√≥n I2C Wire.begin(I2C_SDA, I2C_SCL); // Inicializaci√≥n RTC DS3231 if (!rtc.begin()) { Serial.println("‚ùå No se encontr√≥ el RTC"); } // Verificar la hora del RTC DS3231 if (rtc.lostPower()) { Serial.println("‚ö†Ô∏è RTC sin hora, ajustando a la hora de compilaci√≥n"); rtc.adjust(DateTime(F(__DATE__), F(__TIME__))); } // Configuraci√≥n de Tasks xTaskCreate(readSensors, "Read Sensors", 4096, NULL, 3, NULL); // Elimino el loop vTaskDelete(NULL); } // Task: Lectura de sensores de la planta void readSensors(void* pvParameters) { while(1) { digitalWrite(RGB_RED, 0); digitalWrite(RGB_GREEN, 0); digitalWrite(RGB_BLUE, 1); // Lectura del DHT11 DHT_humidity = dht.readHumidity(); DHT_temperature = dht.readTemperature(); // Lectura del sensor capacitivo CAP_humidity = map(analogRead(HUM_PIN), 100, 820, 100, 0); // Verificar lectura del DHT11 if (isnan(DHT_humidity) || isnan(DHT_temperature)) { Serial.println("‚ùå Error leyendo el DHT11"); } // Lectura del RTC DS3231 rtc_info = rtc.now(); // Lectura de bateria 18650 int raw = analogRead(PIN_BATTERY); BAT_level = raw / 100.0; // Imprimir lectura de sensores Serial.printf("üå° Temp: %.1f ¬∞C | üíß Humedad: %.1f %% | üéá Capacitivo: %.1f %% | ‚è∞ %02d/%02d/%04d %02d:%02d:%02d | üîã %.2f V\r\n", DHT_temperature, DHT_humidity, CAP_humidity, rtc_info.day(), rtc_info.month(), rtc_info.year(), rtc_info.hour(), rtc_info.minute(), rtc_info.second(), BAT_level); // Delay entre lecturas vTaskDelay(pdMS_TO_TICKS(2000)); } } void loop() { }